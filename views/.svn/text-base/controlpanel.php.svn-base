<div class="panel mod<?php

if($this->data['deploying']){
    echo(' deployRunning ');
}

if($this->data['staging']){
    echo(' stageRunning ');
}

?>">
    
    <?php 
//$this->data['deploying'] = $deploying;
// $this->data['staging'] = $deploying;
    $block = $this->data['blocked'];
    
    if(isset($this->data['error'])){

        echo('<h1 style="background:red; color: white">ERROR:');
        echo(" {$this->data['error']['message']}</h1>");

    }?>
    <ul class="steps">
        
        <li>
            <form action="/controlpanel" method="post">
                <input type="hidden" name="action" value="stage">
                <p><input type="submit" <?php
                    if($block == 'hard' || $this->data['staging']){
                        echo('disabled="true"');
                    }
                ?> name="submit"  class="stage" value="Stage"></p>
                <p class="info">
                    <strong>Checks out the current SVN version and moves it to staging.flickr.com</strong>. Also compresses JS/CSS files, bakes the signed-out homepage, and creates language-specific versions of JS files.
                </p>
            </form>
        </li>
        
        <li>
            <form action="/controlpanel" method="post">
                <input type="hidden" name="action" value="showdiff">
                <p><input type="submit"class="diffs" name="submit" value="Show diffs" id="showdiffs"></input></p>
                <p class="info">
                    <strong>Know The Fear.</strong> Displays the changes that will go out with the next deploy. Ensure that nothing is obviously wrong before deploying.
                </p>
            </form>
        </li>
        
        <li>
            <form action="/controlpanel" method="post">
                <input type="hidden" name="action" value="deploy">
                <p><input type="submit" <?php
                    if($block || $this->data['staging']){
                        echo('disabled="true"');
                    }
                ?>class="deploy" name="submit" value="Deploy" id="deploy"></input></p>
                <p class="info">
                    Check the diffs before deploying! Takes the code on staging and pushes it out to all of the production www servers, 5 at a time. Stage 1 does something, stage 2 does something else, and stage 3 also does something
                </p>
            </form>
        </li>
    </ul>
    
    <ul class="other">
        <li>
            <form action="/controlpanel" method="post">
                <input type="hidden" name="action" value="pixie">
                <p><input class="pixie" type="submit" name="submit" value="Recompile Templates" id="pixie"></input></p>
                <p class="info">
                    Ask the Magic Pixie &amp; Sparkly Unicorn to make everything new. Takes 20+ minutes to complete, and will result in a long stage + deploy afterwards. Don't use more than twice an hour.
                </p>
            </form>
        </li>
        
        <li>
            <form action="/controlpanel" id="softblock" <?php if($block){ ?> class="unblock" <?php }?> method="post">
                <?php if($block == 'soft'){ ?>
                <input type="hidden" name="action" value="unblock">
                <input type="text" name="message">
                <p><input class="soft unblock" type="submit" name="submit" value="(soft) Unblock Deploy" id="softblock"></input></p>
                <?php }else { ?>
                <input type="hidden" name="action" value="block">
                <input type="hidden" name="blocktype" value="soft">
                <p><input class="soft block" <?= $block ? 'disabled=true' : ''  ?> type="submit" name="submit" value="Soft Block Deploy" id="softblock"></input></p>
                <?php }?>
                <p class="info">
                    <strong>Programmatically blocks deploy, but not staging.</strong> The block can be removed by anyone.
                </p>
            </form>
        </li>
        
        <li>
            <form action="/controlpanel" id="hardblock"<?php if($block){ ?> class="unblock" <?php }?> method="post">
                <?php if($block == 'hard'){ ?>
                <input type="hidden" name="action" value="unblock">
                <input type="text" name="message">
                <p><input class="hard unblock" type="submit" name="submit" value="Unblock Deploy" id="softblock"></input></p>
                <?php }else { ?>    
                <input type="hidden" name="action" value="block">
                <input type="hidden" name="blocktype" value="hard">
                <input type="text" name="message">
                <p><input class="hard block" <?= $block ? 'disabled=true' : ''  ?> type="submit" name="submit" value="Hard Block Deploy" id="softblock"></input></p>
                <?php }?>
                <p class="info">
                    <strong>Programmatically blocks staging and deploy.</strong> The block can be removed by anyone.
                </p>
            </form>
        </li>
    </ul>
    <ul class="other">
        <li>
            <form action="/controlpanel" method="post">
                <input type="hidden" name="action" value="restart">
                <p><input class="pixie" type="submit" name="submit" value="Rolling Restart" id="restart"></input></p>
                <p class="info">
                    Fire off a rolling restart of yapache on all www hosts. This may take several minutes and will block deploy while it happens. Use with care.
                </p>
            </form>
        </li>
    </ul>
</div>